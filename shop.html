<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetSurfers 2 - Upgrades Shop</title>
    <link rel="manifest" href="manifest.json">
    <script src="weather/snowfall_effect.js"></script>
    <link rel="icon" href="rec/xmas-icon.jpg" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles for Shop Page */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #DC2626 0%, #991B1B 100%); /* Same as index body for consistency */
            color: white;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to the top, not center (for scrolling) */
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
        }

        .shop-container {
            width: 100%;
            max-width: 600px;
            background: #111827;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            border: 2px solid #3b82f6;
            text-align: center;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            padding-bottom: 5px;
        }

        .upgrade-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1f2937;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .upgrade-logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            object-fit: contain;
            flex-shrink: 0; /* Prevent logo from shrinking */
        }

        .coin-image {
            width: 20px; /* Adjust size as needed */
            height: 20px;
            vertical-align: middle; /* Align with the text */
            margin-right: 5px; /* Space between coin and amount */
        }

        .upgrade-info {
            text-align: left;
        }

        .upgrade-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f3f4f6;
        }

        .upgrade-level {
            font-size: 0.9rem;
            color: #9ca3af;
        }
        
        .upgrade-description {
            font-size: 0.85rem;
            color: #d1d5db;
            margin-top: 4px;
        }

        .upgrade-action button {
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 3px #1e40af;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upgrade-action .can-buy {
            background-color: #10b981; /* Green */
            box-shadow: 0 3px #059669;
        }
        .upgrade-action .can-buy:hover {
            background-color: #059669;
        }
        .upgrade-action .can-buy:active {
            transform: translateY(1px);
            box-shadow: 0 2px #059669;
        }

        .upgrade-action .disabled, .upgrade-action .max-level {
            background-color: #4b5563; /* Gray */
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.7;
        }

        .upgrade-action .max-level {
            background-color: #3b82f6; /* Blue for Max */
            color: #e5e7eb;
            font-size: 0.9rem;
        }

        .current-coins {
            font-size: 1.2rem;
            font-weight: bold;
            color: #f59e0b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-button {
            display: inline-block;
            margin-top: 25px;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            background-color: #ef4444; /* Red */
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            box-shadow: 0 3px #b91c1c;
        }
        .back-button:hover {
            background-color: #dc2626;
        }
        .back-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px #b91c1c;
        }
        
        /* New Style for Headstart Buy Button */
        #buyHeadstartButton {
            background-color: #057401; /* Amber/Orange */
            box-shadow: 0 3px #753f00;
        }
        #buyHeadstartButton:hover {
            background-color: #eab308;
        }
        #buyHeadstartButton:active {
            box-shadow: 0 2px #d97706;
        }
    </style>
</head>
<body>

<div class="shop-container">
    <h1 class="text-3xl font-extrabold mb-4 text-cyan-400">UPGRADES SHOP</h1>
    
    <div class="current-coins">
        
        <img src="rec/items/coin.png" alt="Coin" class="coin-image" style="position:absolute; top: 11.6%;5px;"><span id="totalCoinsValue">0</span>
    </div>

    <!-- Inventory / Power-Up Section (New) -->
    <div class="section-title">Power-Ups Inventory</div>
    
    <!-- Headstart Card -->
    <div class="upgrade-card">
        <img src="rec/items/headstart.png" alt="Headstart" class="upgrade-logo" onerror="this.style.display='none'">
        <div class="upgrade-info">
            <div class="upgrade-name">Headstart</div>
            <div class="upgrade-description">
                Boosts your score to <b class="text-yellow-400">20,000</b> at the start of a run. <br>
                <span class="text-sm text-gray-400">Current Stock: <span id="headstartCount">0</span></span>
            </div>
        </div>
        <div class="upgrade-action">
            <button id="buyHeadstartButton" data-cost="500">
                100 <img src="rec/items/coin.png" alt="Coin" class="coin-image">
            </button>
        </div>
    </div>


    <!-- Permanent Upgrade Section -->
    <div class="section-title">Permanent Upgrades</div>

    <!-- Magnet Duration Upgrade Card -->
    <div class="upgrade-card">
        <img src="rec/collectible/magnet.png" alt="Magnet" class="upgrade-logo" onerror="this.style.display='none'">
        <div class="upgrade-info">
            <div class="upgrade-name">Magnet Duration</div>
            <div class="upgrade-level">Level <span id="magnetLevelValue">0</span> / 5</div>
            <div class="upgrade-description">Increases the time a magnet power-up lasts.</div>
        </div>
        <div class="upgrade-action">
            <button id="buyMagnetDurationButton" class="can-buy">
                <span id="magnetCostValue">300</span> <img src="rec/items/coin.png" alt="Coin" class="coin-image">
            </button>
        </div>
    </div>
    
    <a href="index.html" class="back-button">Back to Game</a>

</div>

<script>
    // --- Local Storage Setup (Shared Keys) ---
    const COIN_STORAGE_KEY = 'jetSurferTotalCoins';
    const MAGNET_LEVEL_KEY = 'jetSurferMagnetLevel';
    const HEADSTART_COUNT_KEY = 'jetSurferHeadstartCount'; // NEW KEY

    // --- Upgrade Constants ---
    const MAGNET_UPGRADE_COST = 300;
    const MAGNET_MAX_LEVEL = 5;
    const HEADSTART_COST = 100; // Cost for one Headstart

    // --- State Variables ---
    let totalCoins = 0;
    let magnetLevel = 0;
    let headstartCount = 0; // NEW State variable

    // --- UI Elements ---
    const totalCoinsValueElement = document.getElementById('totalCoinsValue');
    const magnetLevelValueElement = document.getElementById('magnetLevelValue');
    const buyMagnetDurationButton = document.getElementById('buyMagnetDurationButton');
    const magnetCostValueElement = document.getElementById('magnetCostValue');
    const headstartCountElement = document.getElementById('headstartCount'); // NEW
    const buyHeadstartButton = document.getElementById('buyHeadstartButton'); // NEW

    // --- Data Management Functions ---

    function loadGameData() {
        const storedCoins = localStorage.getItem(COIN_STORAGE_KEY);
        totalCoins = storedCoins ? parseInt(storedCoins, 10) : 0;
        
        const storedMagnetLevel = localStorage.getItem(MAGNET_LEVEL_KEY);
        magnetLevel = storedMagnetLevel ? parseInt(storedMagnetLevel, 10) : 0;
        
        const storedHeadstartCount = localStorage.getItem(HEADSTART_COUNT_KEY);
        headstartCount = storedHeadstartCount ? parseInt(storedHeadstartCount, 10) : 0;
    }

    function saveCoins() {
        localStorage.setItem(COIN_STORAGE_KEY, totalCoins);
    }

    function saveMagnetLevel(newLevel) {
        magnetLevel = newLevel;
        localStorage.setItem(MAGNET_LEVEL_KEY, newLevel);
    }
    
    // NEW: Save Headstart Count
    function saveHeadstartCount(newCount) {
        headstartCount = newCount;
        localStorage.setItem(HEADSTART_COUNT_KEY, newCount);
    }

    // --- UI Update Function ---

    function updateShopUI() {
        // Update Coin Display
        totalCoinsValueElement.textContent = totalCoins.toLocaleString();
        
        // Update Headstart Count Display (NEW)
        headstartCountElement.textContent = headstartCount.toLocaleString();

        // --- Magnet UI ---
        magnetLevelValueElement.textContent = magnetLevel;
        const cost = MAGNET_UPGRADE_COST; // Cost is flat for this upgrade

        // Set button state for Magnet Duration
        buyMagnetDurationButton.classList.remove('can-buy', 'disabled', 'max-level');
        buyMagnetDurationButton.disabled = true;

        if (magnetLevel >= MAGNET_MAX_LEVEL) {
            buyMagnetDurationButton.textContent = 'MAX LEVEL';
            buyMagnetDurationButton.classList.add('max-level');
        } else if (totalCoins >= cost) {
            buyMagnetDurationButton.innerHTML = `${cost.toLocaleString()} <img src="rec/items/coin.png" alt="Coin" class="coin-image">`;
            buyMagnetDurationButton.classList.add('can-buy');
            buyMagnetDurationButton.disabled = false;
        } else {
            buyMagnetDurationButton.innerHTML = `${cost.toLocaleString()} <img src="rec/items/coin.png" alt="Coin" class="coin-image"> (Need More)`;
            buyMagnetDurationButton.classList.add('disabled');
        }
        
        // --- Headstart UI (NEW) ---
        buyHeadstartButton.classList.remove('can-buy', 'disabled');
        buyHeadstartButton.disabled = true;
        
        if (totalCoins >= HEADSTART_COST) {
            buyHeadstartButton.innerHTML = `${HEADSTART_COST.toLocaleString()} <img src="rec/items/coin.png" alt="Coin" class="coin-image">`;
            buyHeadstartButton.classList.add('can-buy');
            buyHeadstartButton.disabled = false;
        } else {
            buyHeadstartButton.innerHTML = `${HEADSTART_COST.toLocaleString()} <img src="rec/items/coin.png" alt="Coin" class="coin-image"> (Need More)`;
            buyHeadstartButton.classList.add('disabled');
        }
    }

    // --- Purchase Logic Functions ---
    
    // Logic for purchasing the Magnet Duration upgrade
    function buyMagnetDuration() {
        if (magnetLevel >= MAGNET_MAX_LEVEL) return;
        const cost = MAGNET_UPGRADE_COST;

        if (totalCoins >= cost) {
            // Deduct cost and save
            totalCoins -= cost;
            saveCoins(); 
            
            // Increment and save new level
            saveMagnetLevel(magnetLevel + 1); 
            
            // Refresh the UI
            updateShopUI(); 
        } else {
            console.error("Not enough coins to purchase!");
        }
    }
    
    // NEW: Logic for purchasing Headstart
    function buyHeadstart() {
        const cost = HEADSTART_COST;
        
        if (totalCoins >= cost) {
            // Deduct cost and save
            totalCoins -= cost;
            saveCoins();
            
            // Increment and save new count
            saveHeadstartCount(headstartCount + 1);
            
            // Refresh the UI
            updateShopUI();
        } else {
            console.error("Not enough coins to purchase Headstart!");
        }
    }

    // Initialization and Event Listeners
    window.onload = function() {
        loadGameData(); 
        updateShopUI(); 
        
        // Add click listeners
        buyMagnetDurationButton.addEventListener('click', buyMagnetDuration);
        buyHeadstartButton.addEventListener('click', buyHeadstart); // NEW Listener
    };

</script>
</body>
</html>
